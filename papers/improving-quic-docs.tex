%==================================================================================================
% LaTeX paper template - use as a starting point for structuring a paper.
%
% Written by Colin Perkins (https://csperkins.org/)
% 2002-2017
%
% To the extent possible under law, the author(s) have dedicated all copyright and
% related and neighbouring rights to this software to the public domain worldwide.
% This software is distributed without any warranty.
%
% You should have received a copy of the CC0 Public Domain Dedication along with
% this software. If not, see <http://creativecommons.org/publicdomain/zero/1.0/>.
%
%==================================================================================================
% General advice on technical writing:
%  - George Gopen and Judith Swan, "The Science of Scientific Writing",
%    American Scientist, Nov/Dec 1990. 
%    http://www.americanscientist.org/issues/num2/the-science-of-scientific-writing/1
%  - Stephen Pinker, "The Sense of Style: The Thinking Person's Guide to
%    Writing in the 21st Century", Penguin, Sept 2014. ISBN 0525427929.
%
% The paper writing advice in the comments is derived from talks and articles
% by Simon Peyton-Jones, Jim Kurose, Henning Schulzrinne, and Jim Bednar: 
%  - http://research.microsoft.com/~simonpj/papers/giving-a-talk/giving-a-talk.htm
%  - http://research.microsoft.com/~simonpj/papers/giving-a-talk/writing-a-paper-slides.pdf
%  - http://gaia.cs.umass.edu/kurose/talks/top_10_tips_for_writing_a_paper.ppt
%  - http://www-net.cs.umass.edu/kurose/writing/intro-style.html
%  - http://www.cs.columbia.edu/~hgs/etc/writing-style.html
%  - http://homepages.inf.ed.ac.uk/jbednar/writingtips.html
%  - http://www.gabbay.org.uk/blog/paper-writing.html
%  - http://homes.cs.washington.edu/~mernst/advice/write-technical-paper.html
%  - https://doi.org/10.1371/journal.pcbi.1005619
%
%==================================================================================================
\documentclass[10pt,sigconf]{acmart}
% The \documentclass line will need to be updated to use the appropriate
% class for your chosen venue. 
% 
% For IEEE style use:
%   \documentclass[conference]{IEEEtran}
%
% For the ACM SIGCOMM style use:
%   \documentclass{sig-alternate}
% or
%   \documentclass{sig-alternate-10pt}
% 
% The IEEE and ACM templates are included in the lib/tex/inputs directory.
% The bin/latex-build.sh script is set to search this directory for class
% files before the versions included with your LaTeX distribution. 
% 
% The ACM templates (sig-alternate.cls and sig-alternate-10pt.cls) included
% have been edited to remove \usepackage{epsfig}, as the epsfig package has
% long been deprecated in favour of graphicx. They also include a number of
% other minor bug fixes. These modifications don't change the output format.

% The following packages are recommended, and should be available in most
% standard LaTeX installations (or from https://www.ctan.org/). Note that 
% the order in which these packages are loaded is significant.
\usepackage[l2tabu,orthodox]{nag}  % Warn about use of obsolete LaTeX packages/constructs
\usepackage[utf8]{inputenc}       % This file is formatted in UTF-8
\usepackage[british]{babel}        % Use British hyphenation patterns
\usepackage{ifpdf}                 % Support conditional use of PDF-specific features
% Use the AMS mathematics library for improved mathematics support (see
% http://ctan.org/pkg/amsmath). When this package is loaded, use:
%   \begin{align}
%     ...
%   \end{align} 
% instead of:
%   \begin{eqnarray}
%     ...
%   \end{eqnarray}.  
% (see https://tug.org/pracjourn/2006-4/madsen/madsen.pdf)
\usepackage{amsmath}
\usepackage[all]{onlyamsmath}
% Use Times, Helvetica, and Courier fonts, rather than Computer Modern
\usepackage{upquote}   % Fix quotes in verbatim environments
\usepackage{graphicx}  % Enhanced graphics support
\usepackage{url}       % Add support for typesetting URLs using \url{...}:
% Add support for subfigures, as follows:
%   \begin{figure}
%     \centering
%     \subfloat[caption for 1st subfloat]{
%       \includegraphics{...}
%       \label{...}
%     }
%     \\
%     \subfloat[caption for 2nd subfloat]{
%       \includegraphics{...}
%       \label{...}
%     }
%     \caption{caption for entire figure}
%     \label{...}
%   \end{figure*}
% The subfig package obsoletes the older subfigure package, and is itself
% deprecated in favour of the subcaption package. However, as of April 2015
% subcaption doesn't work with ACM or IEEE style files (this is also the
% reason for the [caption=false] option).
\usepackage[caption=false]{subfig}
% Improve table formatting. This defines three new commands \toprule,
% \midrule, and \bottomrule that should be used instead of \hline in
% tabular environments to get well formatted tables.
\usepackage{booktabs}
% Add support for drawing network packet diagrams. For documentation, see
% http://ctan.org/tex-archive/macros/latex/contrib/bytefield
\usepackage{bytefield}
% Add support for typesetting program source code. For documentation, see
% http://ctan.org/tex-archive/macros/latex/contrib/listings
\usepackage{listings}

% The hyperref package is problematic. Known issues include:
%  - Papers typeset without page numbers gives warnings of the form:
%      "pdfTeX warning (ext4): destination with the same identifier 
%      (name{page.}) has been already used, duplicate ignored".
%    since hyperref tries to refer to the page number.
%  - The algorithmic package uses the same line-numbering scheme for each
%    algorithm, and can cause duplicate identifier warnings if you have
%    several algorithms with line numbers (this may have been fixed with 
%    recent versions of algorithmic...).
%  - If using the algorithm package with hyperref, you need to load packages
%    in the following order (see README in hyperref documentation):
%      \usepackage{float}
%      \usepackage{hyperref}
%      \usepackage{algorithm}
% For these reasons, hyperref is best to avoid for most papers, however if
% needed, uncomment the following two lines:
%  \usepackage{float}
%  \usepackage{hyperref}

% The algorithm package defines the algorithm environment. This is used in
% the same way as the figure and table environments, to include algorithms
% in a paper. The algpseudocode package provides the ability to typeset the
% algorithms: http://ctan.org/tex-archive/macros/latex/contrib/algorithmicx
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{fancyvrb}

\usepackage{color} % Add colour support:

% Define a simple \todo{...} macro:
\newcommand{\todo}[1]{\textbf{\textcolor{red}{To do: #1}}}

%==================================================================================================
\begin{document}
\title{Improving QUIC Protocol Documents}

\author{Stephen McQuistin}
\affiliation{%
  \institution{University of Glasgow}
  \city{Glasgow, UK} 
}
\email{sm@smcquistin.uk}

\author{Colin Perkins}
\affiliation{%
  \institution{University of Glasgow}
  \city{Glasgow, UK} 
}
\email{csp@csperkins.org}

\date{\today}

%==================================================================================================
\begin{abstract}

% Four sentences:
%  - State the problem
%  - Say why it's an interesting problem
%  - Say what your solution achieves
%  - Say what follows from your solution

Standards documents have been slow to adopt formalisms that go beyond the limited syntax
that can be captured by ASCII packet diagrams. As increasingly complex protocols,
including QUIC, are standardised, this situation is likely to result in buggy,
non-conformant implementations. In this paper, we develop the Glasgow Packet
Representation, an abstract, intermediate representation that fully captures the syntax of
packet formats. Specifying protocols in this way reduces human error, and increases the
utility of standards documents.

\end{abstract}

\maketitle

%==================================================================================================
\section{Introduction}

% A good paper introduction is fairly formulaic. If you follow a simple set
% of rules, you can write a very good introduction. The following outline can
% be varied. For example, you can use two paragraphs instead of one, or you
% can place more emphasis on one aspect of the intro than another. But in all
% cases, all of the points below need to be covered in an introduction, and
% in most papers, you don't need to cover anything more in an introduction.
%
% Paragraph 1: Motivation. At a high level, what is the problem area you
% are working in and why is it important? It is important to set the larger
% context here. Why is the problem of interest and importance to the larger
% community?

ASCII packet header diagrams are the most common formalism found in IETF standards
documents. These diagrams allow for the visualisation packet formats, reducing human error
by aiding in the implementation of protocol parsers. However, while ASCII diagrams can
capture much of the syntax of existing protocols, like TCP and UDP, the complexity
introduced by newer protocols, such as QUIC \cite{draft-ietf-quic-transport-latest},
diminishes their utility. As a result, correct parser implementations are much more
reliant upon the careful interpretation of prose descriptions of the protocol's syntax.
This is a situation that is likely to result in buggy and non-conformant implementations.

% Paragraph 2: What is the specific problem considered in this paper? This
% paragraph narrows down the topic area of the paper. In the first
% paragraph you have established general context and importance. Here you
% establish specific context and background.

While there have been many previous efforts to develop formalisms that better capture the
syntax of protocols, these are largely unsuitable for QUIC. QUIC includes protected
packets, requiring decryption using data from packets earlier in the flow. Prior work,
which has focussed on the parsing of individual, unencrypted packets, is unable to model
this. As a result, QUIC, and the broader shift towards pervasive encryption
\cite{rfc7258}, require a new formalism.

% Paragraph 3: "In this paper, we show that...". This is the key paragraph
% in the introduction - you summarize, in one paragraph, what are the main
% contributions of your paper, given the context established in paragraphs 
% 1 and 2. What's the general approach taken? Why are the specific results
% significant? The story is not what you did, but rather:
%  - what you show, new ideas, new insights
%  - why interesting, important?
% State your contributions: these drive the entire paper.  Contributions
% should be refutable claims, not vague generic statements.

In this paper, we describe a framework for formalising the description of packet formats.
Our framework is comprised of three components: an input parser, an intermediary
representation (the Glasgow Packet Representation), and an output formatter. This
architecture allows packets to be described using a number of different languages, and for
such descriptions to be parsed into a common intermediate form. Output formatters can then
use this intermediate representation to generate various artefacts, including parser code.
We provide an example of how this framework can be used to capture the complexity of QUIC,
and automatically generate parser code.

% Paragraph 4: What are the differences between your work, and what others
% have done? Keep this at a high level, as you can refer to future sections
% where specific details and differences will be given, but it is important
% for the reader to know what is new about this work compared to other work
% in the area.

There have been many previous attempts at defining a packet format definition language,
including PacketTypes \cite{mccann2000packet}, Melange \cite{madhavapeddy2007melange},
PADS \cite{fisher2005pads}, and DataScript \cite{back2002datascript}. These languages
typically focus on the parsing of individual, unencrypted packets. Ad-hoc languages, such
as the presentation language used in the TLS 1.3 specification
\cite{draft-ietf-tls-tls13-28}, also see limited adoption. In contrast to these language
definitions, in this paper we develop an abstract protocol representation that, with
\emph{contexts} and \emph{functions} can describe the parsing of any protocol. We develop
a language that generates this intermediate representation, and give examples using QUIC.

% Paragraph 5: "We structure the remainder of this paper as follows." Give
% the reader a road-map for the rest of the paper. Try to avoid redundant
% phrasing, "In Section 2, In section 3, ..., In Section 4, ... ", etc.

We structure the remainder of this paper as follows. Section \ref{sec:motivation} expands
on our motivation, by assessing the utility provided by an ASCII diagram from the QUIC
standards documents, and outlining the requirements of our formalism. Section
\ref{sec:formalising} describes our proposed framework for describing packet formats,
including our intermediary representation, the Glasgow Packet Representation. Section
\ref{sec:casestudy} provides an example of how our framework can be used to capture
the syntax of QUIC's short header packets. Finally, Section \ref{sec:related} discusses
related work, and Section \ref{sec:conclusion} concludes.

%==================================================================================================
% Concentrate single-mindedly on a narrative that:
%  - Describes the problem, and why it's interesting
%  - Describes your idea
%  - Defends your idea, showing how it solves the problem, and filling out
%    the details
% On the way, cite relevant work in passing, but defer discussion to the
% end.
%
% Introduce the problem, and your idea, using examples, and only then
% present the general case. Explain the idea as if your were speaking to
% someone using a whiteboard. Conveying the intuition is primary; details
% follow. Write in a top down manner: state broad themes and ideas first,
% then go into details.
%
% The introduction makes claims. The body of the paper provides evidence
% to support each claim. Check each claim in the introduction, identify
% the evidence, and forward-reference it from the claim. 
%==================================================================================================

\section{Motivation \& Requirements}
\label{sec:motivation}

\begin{figure}
	\centering
	\vspace{3mm}
    \begin{BVerbatim}[fontsize=\scriptsize]
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+
|0|K|1|1|0|R R R|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                Destination Connection ID (0..144)           ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Packet Number (8/16/32)                ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Protected Payload (*)                   ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    \end{BVerbatim}
    \caption{QUIC short header format (from \cite{draft-ietf-quic-transport-latest})}
    \label{fig:quic-short-hdr}
\end{figure}

Broadly, the requirements for our formalism are that it should:
\begin{itemize}
	\item be able to fully capture the information required for \emph{parsing} protocol
		  data units (PDUs);
	\item accommodate various PDU specification languages, including ASCII
		  packet header diagrams, ad-hoc languages
		  such as the TLS 1.3 presentation formation, and more generic packet description
		  languages;
	\item produce output in a number of formats, including ASCII diagrams, and parser
		  code.
\end{itemize}

To demonstrate the limitations of ASCII packet header diagrams in capturing all of the
information required to fully parse PDUs, we consider the diagram for QUIC's short header
PDU, as shown in Figure \ref{fig:quic-short-hdr}. From this diagram, it is clear how the
first octet should be parsed: the widths of each field are known, and, for some, the
values specified. However, it is not clear from the diagram how the Destination Connection
ID, Packet Number, and Protected Payload fields should be parsed. Determining the syntax
of these fields requires the prose descriptions that accompany the diagram; already, it is
clear that ASCII packet header diagrams are not sufficient.

Some of the limitations of ASCII diagrams can be avoided by using an existing packet
description language. Such languages typically allow for intricate field encodings to be
specified. For example, packet numbers use a variable-length integer encoding format,
where the most significant bits of the first octet determine the length of the field.
While it is impractical to represent this behaviour in an ASCII diagram, most packet
description languages enable this format to be captured.

However, we have identified two broad features that are missing from existing packet
description languages that mean that they cannot fully capture the behaviour of QUIC, or
other protocols with encrypted PDUs.

Firstly, existing languages typically enable per-packet modelling, but decryption in QUIC
requires information from packets earlier in the flow. We require flow-level
\emph{context}: essentially a key-value store that can be added to as parsing progresses,
and modelled as part of the protocol specification. For example, the nonce for decrypting
the protected payload field is derived from the packet number. However, the packet only
contains the least significant bits of this number. Contextual information from other
packets in the flow is required to generate the nonce.

Secondly, \emph{how} encrypted fields are parsed must be captured. Existing description
languages have been able to treat encrypted fields as unparsable blobs, enabled by the
separation between protocols. For example, where TCP is used to carry an encrypted
payload, the format of the payload is not specified as part of TCP: the parsing of TCP can
end with the payload as an encrypted blob. However, in QUIC, parsing a short header packet
requires that the protected payload by decrypted, and further parsed into frames. As a
result, we must model \emph{helper functions}, providing the prototype for functions
required in the parsing of the protocol.

To fulfil our second two requirements -- flexibility in both input and output formats --
our formalism must be an abstract, intermediary representation language. Such a
representation can be generated from an arbitrary set of input formats, and can itself be
used to produce various outputs. Abstracting and decoupling the input and output formats
in this way reduces complexity.

%==================================================================================================
\section{Formalising packet formats}
\label{sec:formalising}

In this section, we describe the Glasgow Packet Language (GPL), an abstract, intermediary
protocol description language that satisfies the requirements detailed in Section
\ref{sec:motivation}. Specifically, the language supports both contexts and helper
functions, and is designed to be constructed by an arbitrary description language, and be
used to derive outputs in any format. We give an example that produces a C parser, from an
abbreviated description of the QUIC protocol.

\subsection{The Glasgow Packet Language}

The Glasgow Packet Language is a strong statically typed, object-oriented protocol 
representation language.

\subsection{Input \& output representations}

Description of the input and output formats used in this paper: our packet description
language (input), and C parsing code (output). Descriptions need to be light: they aren't
the focus here. 

%==================================================================================================
\section{Example: QUIC's Short Header}
\label{sec:casestudy}

Already introduced the short header as an example, so no big context switch. Show
(snippets?) of how this would be represented using the input and intermediary formats, and
what output is produced.

%==================================================================================================
\section{Related Work}
\label{sec:related}

% This should come near the end, and focussing on discussing how your work
% relates to that of others. Any relevant related work should have been
% cited already, so this is not a list of related work, it's a discussion
% of how that work relates.
%
% Why not put related work after the introduction? 1) because describing
% alternative approaches gets between the reader and your idea; and 2)
% because the reader knows nothing about the problem yet, so your
% (carefully trimmed) description of various technical trade-offs is
% absolutely incomprehensible.
% 
% When writing the related work:
%  - Give credit to others where it's due; this doesn't diminish the
%    credit you get from your paper. 
%  - Acknowledge weaknesses in your approach.
%  - Ensure related work is accurate and up-to-date

Tour of the various packet description languages. Summarise their limitations (no
contexts, helper functions). Underline the inflexibility of coupling input and output
formats: an intermediary layer makes sense if this is to be adopted (IETF decentralised
structure doesn't lend itself to adopting a single input language).

Also point to other formalisms in use in IETF docs. Some are a bit tangential, but
discussing them here might be a good opportunity to nod at future work (capturing
semantics for packet processing, for example).


\cite{mccann2000packet}

P4 \cite{bosshart:2014:p4,p4consortium:2018:v16spec-20180531} is a language
for programming the data plane of network devices. It is widely used in
software defined networking applications.
P4 describes how packets are parsed and serialised and what state tables
exist in a network devices, and specifies a series of match-action rules
that describe the packet processing and forwarding behaviour of the device.
Parsers in P4 are implemented imperatively, and are built-up from a series
of state machines.
In terms of expressive power, parsers in P4 are comparable to the parsers
we describe and can parse the same formats.
Our approach differs from P4 in that we declaratively define the packet
format, and derive the parser implementation from that declaration. P4,
on the other hand, simply specifies the parser implementation. As such,
P4 could be an appropriate output language for our system.



%==================================================================================================
\section{Conclusions}
\label{sec:conclusion}

%==================================================================================================
\section{Acknowledgements}

This work is funded by the UK Engineering and Physical Sciences Research Council, under
grant EP/R04144X/1.

%==================================================================================================
% Set the bibliography style. 
\bibliographystyle{abbrvurl}
% The abbrvurl style comes from https://www.ctan.org/pkg/urlbst, and is
% included in most standard TeX distributions. It adds support for DOIs
% to the standard abbrv style.
%
% When using the IEEE style, replace the above line with:
%   \bibliographystyle{IEEEtran} 
% The IEEEtran.bst file included here has been modified to support DOIs.

% Load the bibliography file for this paper:
\bibliography{improving-quic-docs}

%==================================================================================================
% The following information gets written into the PDF file information:
\ifpdf
  \pdfinfo{
    /Title        (...)
    /Author       (...)
    /Subject      (...)
    /Keywords     (..., ..., ...)
    /CreationDate (D:20150827110616Z)
    /ModDate      (D:20150827110616Z)
    /Creator      (LaTeX)
    /Producer     (pdfTeX)
  }
  % Suppress unnecessary metadata, to ensure the PDF generated by pdflatex is
  % identical each time it is built:
  \ifdefined\pdftrailerid
    % The \pdftrailerid and \pdfsuppressptexinfo macros were both introduced 
    % in pdfTeX 3.14159265-2.6-1.40.17. If one is present, the other will be.
    \pdftrailerid{}
    \pdfsuppressptexinfo=15
  \fi
\fi
%==================================================================================================
\end{document}
% vim: set ts=2 sw=2 tw=75 et ai:
